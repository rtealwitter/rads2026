<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>High-Dimensional Geometry</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c5a5d5e27fcc88644031c24cff017230.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="shortcut icon" href="../favicon.ico">
<script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>


<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-GZHXTPTRRE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GZHXTPTRRE');
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Spring 2026</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://discord.gg/dES3fSPEeC"> 
<span class="menu-text">Discord</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.gradescope.com/courses/1233250"> 
<span class="menu-text">Gradescope</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#high-dimensional-geometry-is-weird" id="toc-high-dimensional-geometry-is-weird" class="nav-link active" data-scroll-target="#high-dimensional-geometry-is-weird">High-Dimensional Geometry is Weird</a>
  <ul class="collapse">
  <li><a href="#orthogonal-vectors" id="toc-orthogonal-vectors" class="nav-link" data-scroll-target="#orthogonal-vectors">Orthogonal Vectors</a></li>
  <li><a href="#probabilistic-method" id="toc-probabilistic-method" class="nav-link" data-scroll-target="#probabilistic-method">Probabilistic Method</a></li>
  <li><a href="#where-points-live" id="toc-where-points-live" class="nav-link" data-scroll-target="#where-points-live">Where Points Live</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><strong>High-Dimensional Geometry</strong></h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<p>A unifying theme of this course is how we deal with data in high dimensions. We’ll see how to use:</p>
<ul>
<li><p>Locality sensitive hashing to find similar items in high dimensions.</p></li>
<li><p>Low-rank approximations (like singular value decomposition) to find and visualize low-dimensional structure.</p></li>
<li><p>High-dimensional representations of large graphs.</p></li>
</ul>
<p>We often visualize data and algorithms in one, two, or three dimensions. Today, we’ll prove that high-dimensional space looks fundamentally <em>different</em> from low-dimensional space. In particular, we’ll see how our understanding and intuition from low-dimensional space quickly breaks in higher dimensions. After establishing the weirdness of high-dimensional space, we’ll happily ignore the weirdness and see how to reduce the dimension of high-dimensional data.</p>
<section id="high-dimensional-geometry-is-weird" class="level2">
<h2 class="anchored" data-anchor-id="high-dimensional-geometry-is-weird">High-Dimensional Geometry is Weird</h2>
<p>Recall the inner product between two <span class="math inline">\(d\)</span>-dimensional vectors <span class="math inline">\(\mathbf{x}, \mathbf{y} \in \mathbb{R}^d\)</span>. We’ll use bolded notation like <span class="math inline">\(\mathbf{x}\)</span> or <span class="math inline">\(\mathbf{x}_j\)</span> to denote vectors and non-bolded notation like <span class="math inline">\(x[i]\)</span> or <span class="math inline">\(x_i\)</span> to denote scalars. Depending on the context, we’ll use <span class="math inline">\(x[i]\)</span> or <span class="math inline">\(x_i\)</span> to refer to the <span class="math inline">\(i\)</span>th entry of the vector <span class="math inline">\(\mathbf{x}\)</span>. We can write the inner product in several equivalent ways: <span class="math display">\[\begin{align}
\langle \mathbf{x}, \mathbf{y} \rangle
= \mathbf{x}^\top \mathbf{y}
= \mathbf{y}^\top \mathbf{x}
= \sum_{i=1}^d x_i y_i.
\end{align}\]</span> When we take the inner product between a vector and itself, we get the squared norm: <span class="math display">\[\begin{align}
\langle \mathbf{x}, \mathbf{x} \rangle
= \mathbf{x}^\top \mathbf{x}
= \sum_{i=1}^d x_i^2
= \|\mathbf{x}\|_2^2.
\end{align}\]</span> As we know from linear algebra, the inner product is a measure of how similar two vectors are. In particular, we can write <span class="math display">\[\begin{align}
\langle \mathbf{x}, \mathbf{y} \rangle
= \|\mathbf{x}\|_2 \|\mathbf{y}\|_2 \cos \theta,
\end{align}\]</span> where <span class="math inline">\(\theta\)</span> is the angle between <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{y}\)</span>. When <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{y}\)</span> are both unit vectors (their squared norm is 1), the inner product is just the cosine of the angle between them. When <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{y}\)</span> are orthogonal, the angle between them is <span class="math inline">\(\pi/2\)</span> and their inner product is 0.</p>
<section id="orthogonal-vectors" class="level3">
<h3 class="anchored" data-anchor-id="orthogonal-vectors">Orthogonal Vectors</h3>
<p>Let’s start off with a simple question. What is the size of the largest set of mutually orthogonal unit vectors in <span class="math inline">\(d\)</span> dimensions? In other words, what is the largest value of <span class="math inline">\(t\)</span> so that we can have a set of vectors <span class="math inline">\(\mathbf{x}_1, \ldots, \mathbf{x}_t\)</span> such that <span class="math inline">\(\langle \mathbf{x}_i, \mathbf{x}_j \rangle = 0\)</span> for all <span class="math inline">\(i \neq j\)</span>?</p>
<p>The answer is <span class="math inline">\(d\)</span>. One example of such a set of vectors is the standard basis vectors: <span class="math inline">\(\mathbf{x}_i\)</span> has a 1 in the <span class="math inline">\(i\)</span>th entry and 0 everywhere else.</p>
<p>We can also see that <span class="math inline">\(d\)</span> is the largest possible size of such a set by contradiction. Suppose we have a set of more than <span class="math inline">\(d\)</span> orthogonal unit vectors. Since we have <span class="math inline">\(d\)</span> orthogonal vectors in <span class="math inline">\(d\)</span> dimensions, we know that they span the entire space. Then, we can write the <span class="math inline">\(d+1\)</span>th vector as <span class="math display">\[\begin{align}
\mathbf{x}_{d+1} = \sum_{i=1}^d \alpha_i \mathbf{x}_i
\end{align}\]</span> for some coefficients <span class="math inline">\(\alpha_i\)</span> where there is at least one <span class="math inline">\(j\)</span> such that <span class="math inline">\(\alpha_j \neq 0\)</span>. In words, we can write <span class="math inline">\(\mathbf{x}_{d+1}\)</span> as the span of the first <span class="math inline">\(d\)</span> vectors. Taking the inner product of both sides with <span class="math inline">\(\mathbf{x}_j\)</span> gives <span class="math display">\[\begin{align}
\langle \mathbf{x}_{d+1}, \mathbf{x}_j \rangle
= \sum_{i=1}^d \alpha_i \langle \mathbf{x}_i, \mathbf{x}_j \rangle
= \alpha_j.
\end{align}\]</span> We have a contradiction since we assumed <span class="math inline">\(\langle \mathbf{x}_{d+1}, \mathbf{x}_j \rangle = 0\)</span> for all <span class="math inline">\(j \in [d]\)</span>.</p>
<p>Now let’s pose a related question. What is the size of the largest set of <em>nearly</em> orthogonal unit vectors in <span class="math inline">\(d\)</span> dimensions? In other words, what is the largest value of <span class="math inline">\(t\)</span> so that we can have a set of vectors <span class="math inline">\(\mathbf{x}_1, \ldots, \mathbf{x}_t\)</span> such that <span class="math inline">\(|\langle \mathbf{x}_i, \mathbf{x}_j \rangle| \leq \epsilon\)</span> for all <span class="math inline">\(i \neq j\)</span>?</p>
<p>We may expect that the answer is at least close to <span class="math inline">\(d\)</span>. But, it turns out, there is a set with an <em>exponential</em> number of nearly orthogonal vectors.</p>
</section>
<section id="probabilistic-method" class="level3">
<h3 class="anchored" data-anchor-id="probabilistic-method">Probabilistic Method</h3>
<p>We’ll prove this with the probabilistic method. Let <span class="math inline">\(t=2^{c \epsilon^2 d}\)</span> for some constant <span class="math inline">\(c\)</span>. We’ll construct a random process that generates random vectors <span class="math inline">\(\mathbf{x}_1, \ldots, \mathbf{x}_t\)</span> that are unlikely to have large inner products. Then we’ll show that, with non-zero probability, the inner product <span class="math inline">\(|\mathbf{x}_i^\top \mathbf{x}_j| \leq \epsilon\)</span> for all <span class="math inline">\(i \neq j\)</span>. We can then conclude that there must exist <em>some</em> set of <span class="math inline">\(t\)</span> unit vectors with all inner products less than <span class="math inline">\(\epsilon\)</span>.</p>
<p>The random vectors we’ll consider each have entries that are independently <span class="math inline">\(\frac1{\sqrt{d}}\)</span> and <span class="math inline">\(-\frac1{\sqrt{d}}\)</span> with equal probability. Then we can make several observations. The vectors have unit norm: <span class="math display">\[\begin{align}
\|\mathbf{x}_i\|_2^2 = \sum_{j=1}^d x_i[j]^2 = \sum_{j=1}^d \frac1{d} = 1.
\end{align}\]</span> The expected inner product between vectors <span class="math inline">\(i\neq j\)</span> is 0: <span class="math display">\[\begin{align}
\mathbb{E}[\mathbf{x}_i^\top \mathbf{x}_j]
= \sum_{k=1}^d \mathbb{E}\left[x_i[k] x_j[k]\right]
= \sum_{k=1}^d \mathbb{E}[x_i[k]] \mathbb{E}[x_j[k]] = 0.
\end{align}\]</span> The penultimate equality is because each entry is independent. The last equality is because the expected value of each entry is 0. The next observation we can make is that the variance of the inner product is <span class="math inline">\(\frac1{d}\)</span>: <span class="math display">\[\begin{align}
\textrm{Var}[\mathbf{x}_i^\top \mathbf{x}_j]
&amp;= \sum_{k=1}^d \textrm{Var}[x_i[k] x_j[k]]\\
&amp;= \sum_{k=1}^d \mathbb{E}[x_i[k]^2 x_j[k]^2] - \mathbb{E}[x_i[k] x_j[k]]^2 \\
&amp;= \sum_{k=1}^d \frac1{d^2} - 0^2 = \frac1{d}.
\end{align}\]</span> The first equality is by linearity of variance. The third equality is because <span class="math inline">\(x_i[k]^2 = \frac1{d}\)</span>.</p>
<p>Define a random variable <span class="math inline">\(Z = \mathbf{x}_i^\top \mathbf{x}_j
= \sum_{k=1}^d C_k\)</span> where each <span class="math inline">\(C_k\)</span> is <span class="math inline">\(\frac1{d}\)</span> or <span class="math inline">\(-\frac1{d}\)</span> with equal probability. Since <span class="math inline">\(Z\)</span> is a sum of many i.i.d. random variables, we expect <span class="math inline">\(Z\)</span> to approximate a Gaussian. If <span class="math inline">\(Z\)</span> <em>were</em> a Gaussian, then <span class="math display">\[\begin{align}
\Pr\left( | Z | \geq \alpha \frac1{\sqrt{d}}\right) =
\Pr\left( | Z - \mathbb{E}[Z] | \geq \alpha \sigma\right)
\leq O(e^{-\alpha^2}).
\end{align}\]</span> Then we’d be done by setting <span class="math inline">\(\alpha = \epsilon \sqrt{d}\)</span>.</p>
<p>But, since <span class="math inline">\(Z\)</span> only approximates a Gaussian, we need to be a bit more careful. We’d like to apply Chernoff’s bound. However, (our version of) Chernoff’s bound requires that the random variable be binary. With some clever algebra, we can write <span class="math inline">\(Z\)</span> as a sum of binary random variables. <span class="math display">\[\begin{align}
Z &amp;= \sum_{k=1}^d C_k = \frac2{d} \sum_{k=1}^d \frac{d}{2} C_k \\
&amp;= \frac2{d} \sum_{k=1}^d \left( -\frac1{2} + B_k \right) \\
&amp;= \frac2{d} \left( - \frac{d}{2} + \sum_{k=1}^d B_k \right).
\end{align}\]</span> Here, we used the fact that <span class="math inline">\(\frac{d}{2} C_k\)</span> is <span class="math inline">\(\frac1{2}\)</span> or <span class="math inline">\(-\frac1{2}\)</span> with equal probability. Let <span class="math inline">\(B_k\)</span> be a binary random variable that is 1 or 0 with equal probability. Then <span class="math inline">\(\frac{d}{2} C_k =  - \frac12 + B_k\)</span>.</p>
<p>We’re interested in the event that <span class="math inline">\(Z &gt; \epsilon\)</span>. With our expression for <span class="math inline">\(Z\)</span>, this is equivalent to <span class="math display">\[\begin{align}
\sum_{k=1}^d B_k &gt; \frac{d}{2} + \frac{d}{2} \epsilon.
\end{align}\]</span> Similarly, the event that <span class="math inline">\(Z &lt; -\epsilon\)</span> is equivalent to <span class="math display">\[\begin{align}
\sum_{k=1}^d B_k &lt; \frac{d}{2} - \frac{d}{2} \epsilon.
\end{align}\]</span> Let <span class="math inline">\(B = \sum_{k=1}^d B_k\)</span>. Notice that <span class="math inline">\(\mathbb{E}[B] = \frac{d}{2}\)</span>. Putting these last three observations together, we have that <span class="math display">\[\begin{align}
\Pr( | Z | \geq \epsilon)
&amp;= \Pr( B \geq (1+\epsilon) \mathbb{E}[B] )
+ \Pr(B \leq (1-\epsilon) \mathbb{E}[B] ) \\
&amp;= \Pr(| B - \mathbb{E}[B] | \geq \epsilon \mathbb{E}[B]).
\end{align}\]</span> Notice this is exactly in the right form for Chernoff’s bound. Then Chernoff’s bound gives <span class="math display">\[\begin{align}
\Pr( | Z | \geq \epsilon) \leq 2 \exp\left(\frac{-\epsilon^2 \mathbb{E}[B]}{3}\right)
= 2 \exp\left(\frac{-\epsilon^2 d}{6}\right).
\end{align}\]</span></p>
<p>By the union bound, the probability that <em>any</em> pair of vectors has an inner product larger than <span class="math inline">\(\epsilon\)</span> is at most the number of pairs times the probability that a particular pair has an inner product larger than <span class="math inline">\(\epsilon\)</span>. That is, <span class="math display">\[\begin{align}
\Pr( \exists i \neq j : | \mathbf{x}_i^\top \mathbf{x}_j | \geq \epsilon)
\leq \binom{t}{2} 2 \exp\left(\frac{-\epsilon^2 d}{6}\right).
\end{align}\]</span> We want to choose <span class="math inline">\(t\)</span> so that the probability that any pair of vectors has an inner product larger than <span class="math inline">\(\epsilon\)</span> is strictly less than 1. Solving for <span class="math inline">\(t\)</span> we find <span class="math display">\[\begin{align}
\binom{t}{2} 2 \exp\left(\frac{-\epsilon^2 d}{6}\right) &lt; 1
&amp;\Leftrightarrow
t(t-1) &lt; \exp\left( \frac{\epsilon^2d}{6} \right) \\
&amp;\Leftarrow t = \exp\left( \frac{\epsilon^2d}{12} \right)
= 2^{c \epsilon^2 d}
\end{align}\]</span> for <span class="math inline">\(c = \frac{\log_2(e)}{12} \approx 0.12\)</span>. Since the probability that any pair of vectors has an inner product larger than <span class="math inline">\(\epsilon\)</span> is strictly less than 1, there must exist some set of <span class="math inline">\(t\)</span> vectors with all inner products less than <span class="math inline">\(\epsilon\)</span>.</p>
<p>A corollary of the proof that we just saw is that random vectors tend to be far apart in high dimensions. This means that, if our data distribution is random, we typically need an exponential amount of data to learn a pattern. Nonetheless, we often get away with a much smaller amount of data in practice. The reason is that there generally exists a lower dimensional structure in our data that we can learn. For example, data may lie in a low-dimensional subspace (or it does so after a transformation). Alternatively, the pattern we’re learning can come from a specific class of functions that we can learn with a small amount of data.</p>
<p>Before we discuss how to learn low-dimensional structure, let’s see how high-dimensional geometry is so different from what our intuition tells us.</p>
</section>
<section id="where-points-live" class="level3">
<h3 class="anchored" data-anchor-id="where-points-live">Where Points Live</h3>
<p>Let <span class="math inline">\(\mathcal{B}_d(R)\)</span> be the ball in <span class="math inline">\(d\)</span> dimensions with radius <span class="math inline">\(R\)</span>. Formally, <span class="math display">\[\begin{align}
\mathcal{B}_d(R) = \{ \mathbf{x} \in \mathbb{R}^d : \|\mathbf{x}\|_2 \leq R \}.
\end{align}\]</span> We’ll refer to the unit ball simply as <span class="math inline">\(\mathcal{B}_d\)</span>. What fraction of the volume of the unit ball <span class="math inline">\(\mathcal{B}_d\)</span> falls within <span class="math inline">\(\epsilon\)</span> of its surface?</p>
<p align="center">
<img src="images/unit_ball.png" width="400">
</p>
<p>Well we know that the volume of a radius <span class="math inline">\(R\)</span> ball in <span class="math inline">\(d\)</span> dimensions is <span class="math inline">\(\frac{\pi^{d/2}}{(d/2)!} R^d\)</span>. (Here, we assume that <span class="math inline">\(d\)</span> is even but there is a similar expression for odd <span class="math inline">\(d\)</span>.) Then the fraction of the volume within <span class="math inline">\(\epsilon\)</span> of the surface is <span class="math display">\[\begin{align}
\frac{\textrm{Vol}(\mathcal{B}_d) - \textrm{Vol}(\mathcal{B}_d(1-\epsilon))}{\textrm{Vol}(\mathcal{B}_d)}
&amp;= 1- \frac{\frac{\pi^{d/2}}{(d/2)!} (1-\epsilon)^d}{\frac{\pi^{d/2}}{(d/2)!} 1^d}
= 1 - (1-\epsilon)^d \\
&amp;= 1- \left((1-\epsilon)^{1/\epsilon}\right)^{\epsilon d}
\approx 1 - \frac1{e^{\epsilon d}}.
\end{align}\]</span> So all but a <span class="math inline">\(\frac1{2^{c \epsilon d}}\)</span> fraction of the volume of the unit ball is within <span class="math inline">\(\epsilon\)</span> of its surface for a constant <span class="math inline">\(c\)</span>.</p>
<p>We may wonder about how the unit ball compares to other high-dimensional shapes. In fact, by the isoperimetric inequality, the unit ball has the minimum ratio between the surface area and volume of any shape. If we randomly sample points from any high-dimensional shape, nearly all will fall near its surface. One interpretation of this fact is that nearly all points are outliers. Let’s see this intuition for cubes.</p>
<p align="center">
<img src="images/cubes.png" width="400">
</p>
<p>Consider the cubes with side length <span class="math inline">\(10\)</span> in the figure above. In one dimension, the ratio of the cubes on the surface to the total number of cubes is <span class="math inline">\(\frac{2}{10}=.2\)</span>. In two dimensions, the ratio is <span class="math inline">\(\frac{10^2 - 8^2}{10^2} = .36\)</span>. In three dimensions, the ratio is <span class="math inline">\(\frac{10^3 - 8^3}{10^3} = .488\)</span>. As we increase the dimension, the ratio approaches 1.</p>
<p>Now let’s consider a slightly different question about the sphere. What fraction of the volume of the unit ball falls within <span class="math inline">\(\epsilon\)</span> of its equator?</p>
<p align="center">
<img src="images/equator.png" width="400">
</p>
<p>Let <span class="math inline">\(S\)</span> be the set of points within <span class="math inline">\(\epsilon\)</span> of the equator. Formally, <span class="math display">\[\begin{align}
S = \{ \mathbf{x} \in \mathcal{B}_d : |x_1| \leq \epsilon \}.
\end{align}\]</span> Surprisingly, we’ll show that all but a small fraction of the volume of the unit ball falls within <span class="math inline">\(\epsilon\)</span> of its equator. By the symmetry of the unit ball, this is true for <em>any</em> equator.</p>
<p>So:</p>
<ul>
<li><p>We know that all but a <span class="math inline">\(\left(\frac1{2}\right)^{c \epsilon d}\)</span> fraction of the volume of the unit ball is within <span class="math inline">\(\epsilon\)</span> of its surface <em>and</em></p></li>
<li><p>We (are about to) know that all but a <span class="math inline">\(\left(\frac1{2}\right)^{c \epsilon^2 d}\)</span> fraction of the volume of the unit ball is within <span class="math inline">\(\epsilon\)</span> of any equator for some constant <span class="math inline">\(c\)</span>.</p></li>
</ul>
<p align="center">
<img src="images/crazy.png" width="400">
</p>
<p><strong>Claim:</strong> All but a <span class="math inline">\(\left(\frac1{2}\right)^{c \epsilon^2 d}\)</span> fraction of the volume of the unit ball is within <span class="math inline">\(\epsilon\)</span> of any equator for some constant <span class="math inline">\(c\)</span>.</p>
<p>Clearly, the high-dimensional unit ball looks nothing like the circle!</p>
<div class="proof-block">
<details open="">
<summary>
Proof
</summary>
<p>Let’s show our claim that all but a small fraction of the volume of the unit ball falls within <span class="math inline">\(\epsilon\)</span> of its equator. We can show this probabilistically by drawing random points from the unit ball. Formally, we’ll show that if we draw a random point <span class="math inline">\(\mathbf{x}\)</span> from the unit ball, then <span class="math inline">\(|x_1| \leq \epsilon\)</span> with large probability.</p>
<p>Generating a random vector <span class="math inline">\(\mathbf{x}\)</span> from the interior of the unit ball is quite difficult. We’ll instead consider a random vector <span class="math inline">\(\mathbf{w}\)</span> from the surface of the unit ball. Given a random vector <span class="math inline">\(\mathbf{x}\)</span> from the unit ball, we can put it onto the surface of the unit ball by normalizing it: define <span class="math inline">\(\mathbf{w} = \frac{\mathbf{x}}{\|\mathbf{x}\|_2}\)</span>. Because <span class="math inline">\(\|\mathbf{x}\|_2 \leq 1\)</span>, we know <span class="math display">\[\begin{align}
\Pr( |x_1| \leq \epsilon) \geq \Pr( |w_1| \leq \epsilon).
\end{align}\]</span> So it suffices to show that <span class="math inline">\(|w_1| \leq \epsilon\)</span> with probability at least <span class="math inline">\(1-\frac{1}{2^{c \epsilon^2 d}}\)</span>. Let’s consider how to generate a random vector <span class="math inline">\(\mathbf{w}\)</span> from the surface of the unit ball.</p>
<p>Let <span class="math inline">\(\mathbf{g} \in \mathbb{R}^d\)</span> be a random Gaussian vector with each entry drawn from the standard normal distribution <span class="math inline">\(\mathcal{N}(\mathbf{0},\mathbf{I})\)</span>. Then <span class="math inline">\(\mathbf{w} = \frac{\mathbf{g}}{\|\mathbf{g}\|_2}\)</span> is uniformly distributed on the surface of the unit ball. To see why, consider a probability density function <span class="math inline">\(p: \mathbb{R}^d \rightarrow \mathbb{R}\)</span>, with two key properties:</p>
<ul>
<li><p>Independence: The distributions of the individual coordinates are independent.</p></li>
<li><p>Rotational Invariance: The joint density depends only on the distance from the origin i.e., <span class="math inline">\(p(\mathbf{x})\)</span> is a function of <span class="math inline">\(\|\mathbf{x}\|_2\)</span>.</p></li>
</ul>
<p>These two properties are enough to show that <span class="math inline">\(p = \exp( -\|\mathbf{w}\|_2^2)\)</span>, at least up to constants. For a phenomenal explanation of this derivation (often called the Herschel-Maxwell derivation), check out <a href="https://www.youtube.com/watch?v=cy8r7WSuT1I&amp;ab_channel=3Blue1Brown">this</a> 3Blue1Brown video.</p>
<p>In order to analyze <span class="math inline">\(\mathbf{w}\)</span>, we’ll first analyze <span class="math inline">\(\mathbf{g}\)</span>.</p>
<p>The expectation of <span class="math inline">\(\|\mathbf{g}\|_2^2\)</span> is d: <span class="math display">\[\begin{align}\mathbb{E}[ \|\mathbf{g}\|_2^2 ]
= \sum_{i=1}^d \mathbb{E}[g_i^2]
= \sum_{i=1}^d \textrm{Var}(g_i) = d.
\end{align}\]</span></p>
<p>The second equality is because each entry has mean 0 and variance 1. We will use the following inequality: <span class="math display">\[\begin{align}
\Pr \left(\| \mathbf{g} \|_2^2 \leq \frac{d}{2}\right)\leq \frac{1}{2^{c d}}
\end{align}\]</span> for some constant <span class="math inline">\(c\)</span>. The proof uses a concentration inequality for Chi-squared variables and is left as an exercise. To bound the probability that <span class="math inline">\(|w_1| \leq \epsilon\)</span>, we will define two events:</p>
<ol type="1">
<li><p>The norm of the Gaussian vector is sufficiently large: <span class="math inline">\(\| \mathbf{g} \|_2 \geq \sqrt{d/2}\)</span>.</p></li>
<li><p>The first coordinate is sufficiently small: <span class="math inline">\(|g_1| \leq \epsilon \sqrt{d/2}\)</span>.</p></li>
</ol>
Notice that if both of these events occur simultaneously, our main condition is guaranteed. Since <span class="math inline">\(w_1 = \frac{g_1}{\|\mathbf{g}\|_2}\)</span>, we have: <span class="math display">\[\begin{align}
|w_1| = \frac{|g_1|}{\|\mathbf{g}\|_2} \leq \frac{\epsilon \sqrt{d/2}}{\sqrt{d/2}} = \epsilon.
\end{align}\]</span> Therefore, the probability that <span class="math inline">\(|w_1| \leq \epsilon\)</span> is at least the probability of the intersection of these two events. By the union bound, the probability of an intersection is bounded below by <span class="math inline">\(1\)</span> minus the sum of the probabilities of the complement events: <span class="math display">\[\begin{align}
\Pr( |w_1| \leq \epsilon)&amp;\geq \Pr\left( |g_1| \leq \epsilon \sqrt{d/2} \text{ and } \| \mathbf{g} \|_2 \geq \sqrt{d/2} \right) \\
&amp;\geq 1 - \Pr\left( |g_1| &gt; \epsilon \sqrt{d/2} \right) - \Pr\left( \| \mathbf{g} \|_2 &lt; \sqrt{d/2} \right).
\end{align}\]</span> Applying the standard Gaussian tail bound to the first probability, we get <span class="math inline">\(\Pr\left( |g_1| &gt; \epsilon \sqrt{d/2} \right) \leq \frac{1}{2^{\left(c \epsilon \sqrt{d/2}\right)^2}}\)</span>. The second probability is bounded by <span class="math inline">\(\frac{1}{2^{c d}}\)</span> from the Chi-squared inequality above. Substituting these in, we have: <span class="math display">\[\begin{align}
\Pr( |w_1| \leq \epsilon)\geq 1 - \frac{1}{2^{\left(c \epsilon \sqrt{d/2}\right)^2}} - \frac{1}{2^{c d}}.
\end{align}\]</span> This proves the claim that nearly all of the volume of the unit ball falls within <span class="math inline">\(\epsilon\)</span> of its equator.
</details>
</div>
<p>Let <span class="math inline">\(\mathcal{C}_d\)</span> be the <span class="math inline">\(d\)</span>-dimensional unit cube. Formally, <span class="math display">\[\begin{align}
\mathcal{C}_d = \{ \mathbf{x} \in \mathbb{R}^d : |x_i| \leq 1 \textrm{ for all } i \in [d] \}.
\end{align}\]</span> In two dimensions, the cube is pretty similar to the ball.</p>
<p>But in high dimensions, the cube is very different from the ball. The volume of the unit cube is <span class="math inline">\(2^d\)</span> while the volume of the unit ball is <span class="math inline">\(\frac{\pi^{d/2}}{(d/2)!}\)</span>. The ratio of the volume of the unit cube to the unit ball is <span class="math display">\[\begin{align}
\frac{\textrm{Vol}(\mathcal{C}_d)}{\textrm{Vol}(\mathcal{B}_d)}
= \frac{2^d (d/2)!}{\pi^{d/2}}
\approx \sqrt{d}^d.
\end{align}\]</span> The cube has way way more volume!</p>
<p>There are some other ways to see that these shapes are very different. We have <span class="math display">\[\begin{align}
\max_{\mathbf{x} \in \mathcal{B}_d} \|\mathbf{x}\|_2^2 = 1
\hspace{1em} \textrm{ but } \hspace{1em}
\max_{\mathbf{x} \in \mathcal{C}_d} \|\mathbf{x}\|_2^2 = d.
\end{align}\]</span> We may think that such vectors are extreme. However, we have <span class="math display">\[\begin{align}
\mathbb{E}_{\mathbf{x} \sim \mathcal{B}_d} [\|\mathbf{x}\|_2^2 ]\leq 1
\end{align}\]</span> but <span class="math display">\[\begin{align}
\mathbb{E}_{\mathbf{x} \sim \mathcal{C}_d} [\|\mathbf{x}\|_2^2 ]
= \sum_{i=1}^d \mathbb{E}_{x_i \sim \mathcal{U}(-1,1)}[ x_i^2]
= \sum_{i=1}^d \frac13 = \frac{d}{3}.
\end{align}\]</span> For the penultimate equality, we used the following fact about the uniform distribution on <span class="math inline">\([-1,1]\)</span>: The expectation of <span class="math inline">\(x^2\)</span> for <span class="math inline">\(x \sim \mathcal{U}(-1,1)\)</span> is <span class="math display">\[\begin{align}
\int_{x=-1}^1 x^2 \frac1{2} dx = \frac13.
\end{align}\]</span></p>
<p align="center">
<img src="images/high_d_cube.png" width="400">
</p>
<p>Together, we have painted the following picture: Almost all of the volume of the unit cube falls in its corners and these corners lie far outside the unit ball.</p>
<p>Check out the Quanta Magazine article <a href="https://www.quantamagazine.org/a-mathematicians-guided-tour-through-high-dimensions-20210913/">The Journey to Define Dimension</a> for another fun example comparing cubes and balls.</p>
<p>Despite all this warning that low-dimensional space looks nothing like high-dimensional space, we’ll next learn about how to compress high-dimensional vectors into low-dimensional vectors.</p>
<p>We will be very careful not to compress the vectors <em>too</em> far. An extremely simple method known as the Johnson-Lindenstrauss random projection pushes right up to the edge of how much compression is possible.</p>



</section>
</section>

</main> <!-- /main -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const wordsPerMinute = 200;
  const text = document.body.innerText;
  const words = text.trim().split(/\s+/).length;
  const readingTime = Math.ceil(words / wordsPerMinute);

  const readTimeEl = document.createElement("div");
  readTimeEl.innerText = `⏱️ ${readingTime} min read`;

  // Style it to appear centered
  readTimeEl.style.fontSize = "0.9em";
  readTimeEl.style.margin = "1em auto";
  readTimeEl.style.textAlign = "left";
  readTimeEl.style.width = "100%";

  const title = document.querySelector("h1");
  if (title) {
    title.parentNode.insertBefore(readTimeEl, title.nextSibling);
  }
});
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>